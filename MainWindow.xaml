<Window x:Class="SlideShowBob.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:gif="http://wpfanimatedgif.codeplex.com"
        Title="Slide Show Bob"
        Height="650"
        Width="1000"
        Background="{DynamicResource WindowBackgroundBrush}"
        Foreground="{DynamicResource TextPrimaryBrush}"
        Icon="Assets/SlideShowBob.ico"
        FontFamily="Segoe UI"
        FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        WindowStartupLocation="CenterScreen"
        WindowStyle="SingleBorderWindow"
        ResizeMode="CanResize"
        AllowDrop="True"
        PreviewKeyDown="Window_KeyDown"
        MouseMove="Window_MouseMove"
        SizeChanged="Window_SizeChanged"
        DragEnter="Window_DragEnter"
        DragOver="Window_DragOver"
        Drop="Window_Drop"
        ToolTipService.InitialShowDelay="0">



    <Window.Resources>
        <!-- Theme resources are defined globally in App.xaml -->

        <!-- ===== Global text style ===== -->
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="TextOptions.TextFormattingMode" Value="Ideal"/>
            <Setter Property="FontFamily" Value="Segoe UI Variable"/>
        </Style>

        <!-- ===== Modern Icon Button - No border, hover background, fixed size ===== -->
        <Style x:Key="IconButton" TargetType="Button">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontFamily" Value="Segoe UI Symbol"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="MinWidth" Value="32"/>
            <Setter Property="MinHeight" Value="32"/>
            <Setter Property="MaxWidth" Value="32"/>
            <Setter Property="MaxHeight" Value="32"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                CornerRadius="2"
                                SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background"
                                        Value="{StaticResource HoverOverlayBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Root" Property="Background"
                                        Value="{StaticResource ControlBackgroundPressedBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                                <Setter Property="Foreground" Value="{StaticResource TextDisabledBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ===== Big icon button (center "Select Folder") ===== -->
        <Style x:Key="BigIconButton" TargetType="Button">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="36"/>
            <Setter Property="FontFamily" Value="Segoe UI Symbol"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Width" Value="80"/>
            <Setter Property="Height" Value="80"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="12"
                                                  ShadowDepth="0"
                                                  Opacity="0.4"
                                                  Color="#000000"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background"
                                        Value="{StaticResource AccentBrushHover}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Root" Property="Background"
                                        Value="{StaticResource AccentBrushSecondary}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ===== Modern Toggle Button - Blue when active, minimal corners ===== -->
        <Style x:Key="PillToggle" TargetType="ToggleButton">
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="Pill"
                                Background="{TemplateBinding Background}"
                                CornerRadius="2">
                            <ContentPresenter HorizontalAlignment="Center"
                                          VerticalAlignment="Center"
                                          Margin="6,0"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Pill" Property="Background"
                                        Value="{StaticResource ControlBackgroundHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                <Setter TargetName="Pill" Property="Background"
                                        Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsChecked" Value="True"/>
                                    <Condition Property="IsMouseOver" Value="True"/>
                                </MultiTrigger.Conditions>
                                <Setter TargetName="Pill" Property="Background" Value="{StaticResource AccentBrushHover}"/>
                            </MultiTrigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ===== Modern progress bar ===== -->
        <Style TargetType="ProgressBar">
            <Setter Property="Height" Value="3"/>
            <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Background" Value="{StaticResource SurfaceAltBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>


        <!-- ===== Modern TextBox - No border, sized to content with 3 padding ===== -->
        <Style TargetType="TextBox">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="3"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="MinWidth" Value="40"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="Border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="2">
                            <ScrollViewer x:Name="PART_ContentHost"
                                        Margin="{TemplateBinding Padding}"
                                        Focusable="False"
                                        HorizontalScrollBarVisibility="Hidden"
                                        VerticalScrollBarVisibility="Hidden"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background"
                                        Value="{StaticResource HoverOverlayBrush}"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="Border" Property="Background"
                                        Value="{StaticResource HoverOverlayBrush}"/>
                                <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource AccentBrush}"/>
                                <Setter TargetName="Border" Property="BorderThickness" Value="1"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Keep your existing storyboard (unchanged) -->
        <Storyboard x:Key="SlideTransitionFade">
            <DoubleAnimation
                Storyboard.TargetName="MediaContainer"
                Storyboard.TargetProperty="Opacity"
                From="0.0" To="1.0" Duration="0:0:1"/>
        </Storyboard>

        <!-- Loading overlay fade in animation -->
        <Storyboard x:Key="LoadingOverlayFadeIn">
            <DoubleAnimation
                Storyboard.TargetName="LoadingOverlay"
                Storyboard.TargetProperty="Opacity"
                From="0.0" To="1.0" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!-- Loading overlay fade out animation -->
        <Storyboard x:Key="LoadingOverlayFadeOut">
            <DoubleAnimation
                Storyboard.TargetName="LoadingOverlay"
                Storyboard.TargetProperty="Opacity"
                From="1.0" To="0.0" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>


    </Window.Resources>


    <Grid Background="{StaticResource WindowBackdropBrush}" 
          PreviewMouseRightButtonUp="MainGrid_PreviewMouseRightButtonUp"
          PreviewMouseLeftButtonUp="MainGrid_PreviewMouseLeftButtonUp">

        <!-- CONTENT AREA -->
        <Grid x:Name="ContentGrid">
            <Grid.RowDefinitions>
                <!-- Row 0: Main viewport - fills all available space -->
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            
            <!-- Media -->
            <Border Background="{StaticResource WindowBackdropBrush}"
                    Grid.Row="0">
                <Grid x:Name="MediaContainer" Opacity="0.0">
                    <Grid.Style>
                        <Style TargetType="Grid">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding HasMediaItems}" Value="True">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>
                    <!-- Blurred background for portrait images - behind everything -->
                    <Image x:Name="BlurredBackgroundImage"
                           Panel.ZIndex="0"
                           Stretch="UniformToFill"
                           RenderOptions.BitmapScalingMode="HighQuality"
                           HorizontalAlignment="Stretch"
                           VerticalAlignment="Stretch"
                           Visibility="Collapsed"
                           Opacity="0.5">
                        <Image.Effect>
                            <BlurEffect Radius="50" KernelType="Gaussian"/>
                        </Image.Effect>
                    </Image>
                    
                    <ScrollViewer x:Name="ScrollHost"
                                  Panel.ZIndex="1"
                                  HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Auto"
                                  CanContentScroll="False"
                                  Background="Transparent"
                                  PanningMode="Both"
                                  PreviewMouseWheel="ScrollHost_PreviewMouseWheel"
                                  PreviewMouseRightButtonUp="ScrollHost_PreviewMouseRightButtonUp"
                                  PreviewMouseLeftButtonUp="ScrollHost_PreviewMouseLeftButtonUp">
                        <Border x:Name="ContentBorder">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Margin" Value="0,0,0,0"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HasScrollBars, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                            <Setter Property="Margin" Value="0,0,12,12"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid x:Name="MediaGrid"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center">
                            <!-- Static frame image for video (first/last frame) - behind video -->
                            <Image x:Name="VideoFrameImage"
                                   Stretch="Uniform"
                                   RenderOptions.BitmapScalingMode="HighQuality"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Visibility="Collapsed"
                                   Opacity="0"
                                   MouseLeftButtonUp="Media_MouseLeftButtonUp"
                                   MouseRightButtonUp="Media_MouseRightButtonUp" />
                            <MediaElement x:Name="VideoElement"
                                          LoadedBehavior="Manual"
                                          UnloadedBehavior="Stop"
                                          Stretch="None"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center"
                                          Visibility="Collapsed"
                                          MouseLeftButtonUp="Media_MouseLeftButtonUp"
                                          MouseRightButtonUp="Media_MouseRightButtonUp"/>
                            <Image x:Name="ImageElement"
                                   Stretch="Uniform"
                                   RenderOptions.BitmapScalingMode="HighQuality"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   MouseLeftButtonUp="Media_MouseLeftButtonUp"
                                   MouseRightButtonUp="Media_MouseRightButtonUp" />
                            </Grid>
                        </Border>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- Empty state panel (shown when no media is loaded) -->
            <Border x:Name="EmptyStatePanel"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Panel.ZIndex="100"
                    IsHitTestVisible="True">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasMediaItems}" Value="True">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <StackPanel Orientation="Vertical"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            TextBlock.TextAlignment="Center">
                    <TextBlock Text="No media loaded"
                               FontSize="16"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               Margin="0,0,0,16"/>
                    <Button Content="Add Folder"
                            Command="{Binding AddFolderCommand}"
                            Padding="16,8"
                            FontSize="13"
                            HorizontalAlignment="Center"
                            Cursor="Hand">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="Root"
                                                    Background="{TemplateBinding Background}"
                                                    CornerRadius="4"
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center"
                                                                  VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Root" Property="Background"
                                                            Value="{StaticResource AccentBrushHover}"/>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter TargetName="Root" Property="Background"
                                                            Value="{StaticResource AccentBrushSecondary}"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </Border>

            <!-- Expanded modern toolbar: centered, auto width, minimal design -->
            <Border x:Name="ToolbarExpandedPanel"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Bottom"
                            CornerRadius="4,4,0,0"
                            Background="{StaticResource SurfaceAltBrush}"
                            BorderThickness="0"
                            Padding="8,6"
                            Opacity="0.98"
                            Panel.ZIndex="100">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Margin" Value="0,0,0,0"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasScrollBars, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                <Setter Property="Margin" Value="0,0,0,12"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>

                <Border.RenderTransform>
                    <TranslateTransform x:Name="ExpandedTransform" Y="0"/>
                </Border.RenderTransform>
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.3" Color="#000000"/>
                </Border.Effect>
                <Grid>
                    <!-- Single row: all controls centered with vertical separators -->
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                        <!-- Prev / Play / Pause / Next with modern icons -->
                        <Button x:Name="PrevButton"
                                ToolTip="Previous"
                                Command="{Binding PreviousCommand}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                    <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                    <Setter Property="Content" Value="&#xE892;"/>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="StartButton"
                                ToolTip="Start slideshow"
                                Command="{Binding StartSlideshowCommand}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                    <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                    <Setter Property="Content" Value="&#xEDB5;"/>
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsPlaying}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Button x:Name="StopButton"
                                ToolTip="Pause slideshow"
                                Command="{Binding StopSlideshowCommand}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                    <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                    <Setter Property="Content" Value="&#xE769;"/>
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsPlaying}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="NextButton"
                                ToolTip="Next"
                                Command="{Binding NextCommand}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                    <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                    <Setter Property="Content" Value="&#xE893;"/>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="ReplayButton"
                                ToolTip="Replay video"
                                Click="ReplayButton_Click">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                    <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                    <Setter Property="Content" Value="&#xE72C;"/>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <ToggleButton x:Name="FitToggle"
                                      Style="{StaticResource PillToggle}"
                                      Content="Fit"
                                      ToolTip="Fit to window"
                                      IsChecked="True"
                                      Checked="FitToggle_Checked"
                                      Unchecked="FitToggle_Unchecked"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <TextBlock Text="Zoom"
                                   Margin="8,0,4,0"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontSize="12"/>
                        <TextBlock x:Name="ZoomLabel"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontSize="12"
                                   Margin="0,0,4,0"
                                   MinWidth="40"/>
                        <Button x:Name="ZoomResetButton"
                                Style="{StaticResource IconButton}"
                                Content="100%"
                                ToolTip="Reset zoom to 100%"
                                Click="ZoomResetButton_Click"
                                FontSize="11"
                                FontFamily="Segoe UI Variable"
                                MinWidth="40"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <ToggleButton x:Name="IncludeVideoToggle"
                                      Style="{StaticResource PillToggle}"
                                      Content="GIF / MP4"
                                      ToolTip="Include videos and GIFs"
                                      IsChecked="{Binding IncludeVideos, Mode=TwoWay}"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="MuteButton"
                                ToolTip="Mute/Unmute"
                                Click="MuteButton_Click">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                    <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                    <Setter Property="Content" Value="&#xE74F;"/>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="FullscreenButton"
                                Content="⛶"
                                ToolTip="Toggle fullscreen"
                                Click="FullscreenButton_Click">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsFullscreen, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Button x:Name="MonitorButton"
                                ToolTip="Change fullscreen monitor"
                                Click="MonitorButton_Click">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                    <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                    <Setter Property="Content" Value="&#xE7F8;"/>
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsFullscreen, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="SelectFolderButton"
                                ToolTip="Change folder"
                                Command="{Binding AddFolderCommand}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                    <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                    <Setter Property="Content" Value="&#xED25;"/>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="PlaylistButton"
                                ToolTip="Playlist editor"
                                Command="{Binding OpenPlaylistCommand}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                    <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                    <Setter Property="Content" Value="&#xE700;"/>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="SortButton"
                                Style="{StaticResource IconButton}"
                                Content="⇅"
                                ToolTip="Sort options"
                                Click="SortButton_Click">
                            <Button.ContextMenu>
                                <ContextMenu x:Name="SortMenu">
                                    <MenuItem x:Name="SortNameAZ"
                                              Header="Name (A-Z)"
                                              Tag="NameAZ"
                                              Click="SortMenuItem_Click"/>
                                    <MenuItem x:Name="SortNameZA"
                                              Header="Name (Z-A)"
                                              Tag="NameZA"
                                              Click="SortMenuItem_Click"/>
                                    <MenuItem x:Name="SortDateOldest"
                                              Header="Date (Oldest First)"
                                              Tag="DateOldest"
                                              Click="SortMenuItem_Click"/>
                                    <MenuItem x:Name="SortDateNewest"
                                              Header="Date (Newest First)"
                                              Tag="DateNewest"
                                              Click="SortMenuItem_Click"/>
                                    <MenuItem x:Name="SortRandom"
                                              Header="Random"
                                              Tag="Random"
                                              Click="SortMenuItem_Click"/>
                                </ContextMenu>
                            </Button.ContextMenu>
                        </Button>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="SettingsButton"
                                ToolTip="App Settings"
                                Command="{Binding OpenSettingsCommand}">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                    <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                    <Setter Property="Content" Value="&#xE713;"/>
                                </Style>
                            </Button.Style>
                        </Button>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <TextBlock Text="Delay"
                                   Margin="8,0,4,0"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontSize="12"/>
                        <TextBox x:Name="DelayBox"
                                 Text="{Binding SlideDelayMs, Mode=TwoWay, UpdateSourceTrigger=LostFocus}"
                                 VerticalContentAlignment="Center"
                                 MinWidth="50"
                                 TextAlignment="Right"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <!-- Collapse toolbar -->
                        <Button x:Name="ToolbarCollapseButton"
                                Style="{StaticResource IconButton}"
                                Content="▾"
                                ToolTip="Minimize toolbar"
                                Click="ToolbarCollapseButton_Click"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Minimized notch toolbar with minimal design -->
            <Border x:Name="ToolbarNotchPanel"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Bottom"
                    CornerRadius="4,4,0,0"
                    Background="{StaticResource SurfaceAltBrush}"
                    BorderThickness="0"
                    Padding="6,4"
                    Opacity="0"
                    Visibility="Collapsed"
                    Panel.ZIndex="100">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Margin" Value="0,0,0,0"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasScrollBars, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                <Setter Property="Margin" Value="0,0,0,12"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Border.RenderTransform>
                    <TranslateTransform x:Name="NotchTransform" Y="0"/>
                </Border.RenderTransform>
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.3" Color="#000000"/>
                </Border.Effect>
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Margin="0">
                    <Button x:Name="NotchPrevButton"
                            ToolTip="Previous"
                            Command="{Binding PreviousCommand}">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                <Setter Property="Content" Value="&#xE892;"/>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                    <Button x:Name="NotchPlayPauseButton"
                            ToolTip="Play/Pause"
                            Command="{Binding PlayPauseCommand}">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                <Setter Property="Content" Value="&#xEDB5;"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsPlaying}" Value="True">
                                        <Setter Property="Content" Value="&#xE769;"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                    <Button x:Name="NotchNextButton"
                            ToolTip="Next"
                            Command="{Binding NextCommand}">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                <Setter Property="Content" Value="&#xE893;"/>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                    <Button x:Name="NotchFullscreenButton"
                            Content="⛶"
                            ToolTip="Toggle fullscreen"
                            Click="FullscreenButton_Click">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                <Setter Property="Visibility" Value="Visible"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsFullscreen, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Button x:Name="NotchMonitorButton"
                            ToolTip="Change fullscreen monitor"
                            Click="MonitorButton_Click">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                <Setter Property="Content" Value="&#xE7F8;"/>
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsFullscreen, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                    <Button ToolTip="Playlist"
                            Command="{Binding OpenPlaylistCommand}">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                <Setter Property="FontFamily" Value="Segoe MDL2 Assets"/>
                                <Setter Property="Content" Value="&#xE700;"/>
                            </Style>
                        </Button.Style>
                    </Button>

                    <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                    <Button x:Name="ToolbarExpandButton"
                            Style="{StaticResource IconButton}"
                            Content="▴"
                            ToolTip="Expand toolbar"
                            Click="ToolbarExpandButton_Click"/>
                </StackPanel>
            </Border>

            <Border x:Name="StatusBar"
                    VerticalAlignment="Bottom"
                    HorizontalAlignment="Left"
                    Margin="16,0,0,24"
                    Padding="8,6"
                    Background="Transparent"
                    BorderThickness="0">
                <Border.Style>
                    <Style TargetType="Border">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasScrollBars, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                <Setter Property="Margin" Value="16,0,0,36"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <TextBlock x:Name="StatusText"
                           FontSize="11"
                           Foreground="{StaticResource TextMutedBrush}"
                           Text="{Binding StatusText}"
                           TextTrimming="CharacterEllipsis"
                           TextWrapping="NoWrap"/>
            </Border>

            <TextBlock x:Name="TitleCountText"
                       VerticalAlignment="Bottom"
                       HorizontalAlignment="Right"
                       Margin="0,0,16,24"
                       FontSize="12"
                       Foreground="{StaticResource TextMutedBrush}">
                <TextBlock.Inlines>
                    <Run Text="{Binding DisplayIndex, Mode=OneWay}"/>
                    <Run Text=" / "/>
                    <Run Text="{Binding TotalCount, Mode=OneWay}"/>
                </TextBlock.Inlines>
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding HasScrollBars, RelativeSource={RelativeSource AncestorType=Window}}" Value="True">
                                <Setter Property="Margin" Value="0,0,16,36"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>

            <!-- Very bottom thin progress bar (video) -->
            <ProgressBar x:Name="VideoProgressBar"
                         Height="4"
                         Minimum="0"
                         Maximum="100"
                         Width="200"
                         VerticalAlignment="Bottom"
                         Visibility="Collapsed"
                         MouseDown="VideoProgressBar_MouseDown"
                         MouseMove="VideoProgressBar_MouseMove"
                         MouseLeave="VideoProgressBar_MouseLeave"
                         Panel.ZIndex="110"/>
            
            <!-- Loading overlay -->
            <Border x:Name="LoadingOverlay"
                    Background="#80000000"
                    Opacity="0"
                    Visibility="Collapsed"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Panel.ZIndex="200"
                    IsHitTestVisible="False">
                <Grid>
                    <StackPanel HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Orientation="Vertical">
                        <ProgressBar IsIndeterminate="True"
                                     Width="100"
                                     Height="4"
                                     Margin="0,0,0,12"
                                     Foreground="{StaticResource AccentBrush}"/>
                        <TextBlock Text="Loading..."
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   FontSize="14"
                                   HorizontalAlignment="Center"
                                   Opacity="0.9"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Fullscreen top overlay: File name and slide index (only in fullscreen) -->
            <Border x:Name="FullscreenTopOverlay"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Top"
                    Background="{StaticResource SurfaceAltBrush}"
                    Opacity="0"
                    Visibility="Collapsed"
                    Padding="16,10"
                    Panel.ZIndex="150"
                    IsHitTestVisible="False">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.3" Color="#000000"/>
                </Border.Effect>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0"
                               Text="{Binding CurrentFileName, Mode=OneWay}"
                               FontSize="13"
                               Foreground="{StaticResource TextPrimaryBrush}"
                               TextTrimming="CharacterEllipsis"
                               VerticalAlignment="Center"
                               Margin="8,0"/>
                    <TextBlock Grid.Column="1"
                               Margin="16,0,8,0"
                               FontSize="13"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               VerticalAlignment="Center">
                        <TextBlock.Inlines>
                            <Run Text="{Binding DisplayIndex, Mode=OneWay}"/>
                            <Run Text=" / "/>
                            <Run Text="{Binding TotalCount, Mode=OneWay}"/>
                        </TextBlock.Inlines>
                    </TextBlock>
                </Grid>
            </Border>
        </Grid>
        <TextBlock x:Name="HoverTimeText"
                   Margin="8,0,0,0"
                   VerticalAlignment="Center"
                   Foreground="{StaticResource TextSecondaryBrush}"
                   FontSize="10"
                   Visibility="Collapsed"/>
    </Grid>
</Window>
