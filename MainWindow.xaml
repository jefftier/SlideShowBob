<Window x:Class="SlideShowBob.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:gif="http://wpfanimatedgif.codeplex.com"
        Title="Slide Show Bob"
        Height="650"
        Width="1000"
        Background="{DynamicResource WindowBackgroundBrush}"
        Foreground="{DynamicResource TextPrimaryBrush}"
        Icon="Assets/SlideShowBob.ico"
        FontFamily="Segoe UI"
        FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        WindowStartupLocation="CenterScreen"
        WindowStyle="SingleBorderWindow"
        ResizeMode="CanResize"
        AllowDrop="True"
        KeyDown="Window_KeyDown"
        MouseMove="Window_MouseMove"
        SizeChanged="Window_SizeChanged"
        DragEnter="Window_DragEnter"
        DragOver="Window_DragOver"
        Drop="Window_Drop">



    <Window.Resources>

        <!-- ===== Fluent 2 / Windows 11 Modern Color Palette ===== -->
        <SolidColorBrush x:Key="WindowBackgroundBrush" Color="#0F0F0F"/>
        <LinearGradientBrush x:Key="WindowBackdropBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#1A1A1A" Offset="0.0"/>
            <GradientStop Color="#0F0F0F" Offset="1.0"/>
        </LinearGradientBrush>

        <SolidColorBrush x:Key="SurfaceBrush" Color="#1C1C1C"/>
        <SolidColorBrush x:Key="SurfaceAltBrush" Color="#242424"/>

        <SolidColorBrush x:Key="AccentBrush" Color="#0078D4"/>
        <SolidColorBrush x:Key="AccentBrushHover" Color="#106EBE"/>
        <SolidColorBrush x:Key="AccentBrushSecondary" Color="#005A9E"/>

        <SolidColorBrush x:Key="SubtleBorderBrush" Color="#2A2A2A"/>
        <SolidColorBrush x:Key="SubtleBorderStrongBrush" Color="#3A3A3A"/>

        <SolidColorBrush x:Key="TextPrimaryBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="#CCCCCC"/>
        <SolidColorBrush x:Key="TextMutedBrush" Color="#999999"/>

        <SolidColorBrush x:Key="ControlBackgroundBrush" Color="Transparent"/>
        <SolidColorBrush x:Key="ControlBackgroundHoverBrush" Color="#2A2A2A"/>
        <SolidColorBrush x:Key="ControlBackgroundPressedBrush" Color="#333333"/>

        <!-- ===== Global text style ===== -->
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="TextOptions.TextFormattingMode" Value="Ideal"/>
            <Setter Property="FontFamily" Value="Segoe UI Variable"/>
        </Style>

        <!-- ===== Modern Icon Button - No border, hover background, fixed size ===== -->
        <Style x:Key="IconButton" TargetType="Button">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontFamily" Value="Segoe UI Symbol"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="MinWidth" Value="32"/>
            <Setter Property="MinHeight" Value="32"/>
            <Setter Property="MaxWidth" Value="32"/>
            <Setter Property="MaxHeight" Value="32"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                CornerRadius="2"
                                SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background"
                                        Value="{StaticResource ControlBackgroundHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Root" Property="Background"
                                        Value="{StaticResource ControlBackgroundPressedBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ===== Big icon button (center "Select Folder") ===== -->
        <Style x:Key="BigIconButton" TargetType="Button">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="36"/>
            <Setter Property="FontFamily" Value="Segoe UI Symbol"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Width" Value="80"/>
            <Setter Property="Height" Value="80"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="12"
                                                  ShadowDepth="0"
                                                  Opacity="0.4"
                                                  Color="#000000"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background"
                                        Value="{StaticResource AccentBrushHover}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Root" Property="Background"
                                        Value="{StaticResource AccentBrushSecondary}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ===== Modern Toggle Button - Blue when active, minimal corners ===== -->
        <Style x:Key="PillToggle" TargetType="ToggleButton">
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="Pill"
                                Background="{TemplateBinding Background}"
                                CornerRadius="2">
                            <ContentPresenter HorizontalAlignment="Center"
                                          VerticalAlignment="Center"
                                          Margin="6,0"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Pill" Property="Background"
                                        Value="{StaticResource ControlBackgroundHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Foreground" Value="White"/>
                                <Setter TargetName="Pill" Property="Background"
                                        Value="{StaticResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <ColorAnimation Storyboard.TargetName="Pill"
                                                           Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                           To="#0078D4"
                                                           Duration="0:0:0.15"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ===== Modern progress bar ===== -->
        <Style TargetType="ProgressBar">
            <Setter Property="Height" Value="3"/>
            <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Background" Value="#2A2A2A"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>

        <!-- ===== Modern minimalistic scrollbar style ===== -->
        <Style TargetType="ScrollBar">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="8"/>
            <Setter Property="MinWidth" Value="8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid x:Name="GridRoot" Background="Transparent">
                            <Track x:Name="PART_Track" IsDirectionReversed="False" Focusable="False">
                                <Track.Thumb>
                                    <Thumb x:Name="Thumb" Background="{StaticResource SubtleBorderBrush}" 
                                           BorderThickness="0" Margin="2,0">
                                        <Thumb.Style>
                                            <Style TargetType="Thumb">
                                                <Setter Property="Background" Value="{StaticResource SubtleBorderBrush}"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Thumb">
                                                            <Border Background="{TemplateBinding Background}" 
                                                                    CornerRadius="2" 
                                                                    Opacity="0.4"/>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Opacity" Value="0.7"/>
                                                                </Trigger>
                                                                <Trigger Property="IsDragging" Value="True">
                                                                    <Setter Property="Opacity" Value="0.9"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Thumb.Style>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ===== Modern TextBox - No border, sized to content with 3 padding ===== -->
        <Style TargetType="TextBox">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="3"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="MinWidth" Value="40"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="Border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="2">
                            <ScrollViewer x:Name="PART_ContentHost"
                                        Margin="{TemplateBinding Padding}"
                                        Focusable="False"
                                        HorizontalScrollBarVisibility="Hidden"
                                        VerticalScrollBarVisibility="Hidden"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background"
                                        Value="{StaticResource ControlBackgroundHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="Border" Property="Background"
                                        Value="{StaticResource ControlBackgroundHoverBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Keep your existing storyboard (unchanged) -->
        <Storyboard x:Key="SlideTransitionFade">
            <DoubleAnimation
                Storyboard.TargetName="MediaContainer"
                Storyboard.TargetProperty="Opacity"
                From="0.0" To="1.0" Duration="0:0:1"/>
        </Storyboard>

        <!-- Loading overlay fade in animation -->
        <Storyboard x:Key="LoadingOverlayFadeIn">
            <DoubleAnimation
                Storyboard.TargetName="LoadingOverlay"
                Storyboard.TargetProperty="Opacity"
                From="0.0" To="1.0" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!-- Loading overlay fade out animation -->
        <Storyboard x:Key="LoadingOverlayFadeOut">
            <DoubleAnimation
                Storyboard.TargetName="LoadingOverlay"
                Storyboard.TargetProperty="Opacity"
                From="1.0" To="0.0" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <QuadraticEase EasingMode="EaseIn"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

    </Window.Resources>


    <Grid Background="{StaticResource WindowBackdropBrush}" 
          PreviewMouseRightButtonUp="MainGrid_PreviewMouseRightButtonUp"
          PreviewMouseLeftButtonUp="MainGrid_PreviewMouseLeftButtonUp">

        <!-- CONTENT AREA -->
        <Grid x:Name="ContentGrid">
            <!-- Media -->
            <Border Background="{StaticResource WindowBackdropBrush}">
                <Grid x:Name="MediaContainer" Opacity="0.0">
                    <!-- Blurred background for portrait images - behind everything -->
                    <Image x:Name="BlurredBackgroundImage"
                           Stretch="UniformToFill"
                           RenderOptions.BitmapScalingMode="HighQuality"
                           HorizontalAlignment="Stretch"
                           VerticalAlignment="Stretch"
                           Visibility="Collapsed"
                           Opacity="0.5">
                        <Image.Effect>
                            <BlurEffect Radius="50" KernelType="Gaussian"/>
                        </Image.Effect>
                    </Image>
                    
                    <ScrollViewer x:Name="ScrollHost"
                                  HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Auto"
                                  CanContentScroll="False"
                                  Background="Transparent"
                                  PreviewMouseWheel="ScrollHost_PreviewMouseWheel"
                                  PreviewMouseRightButtonUp="ScrollHost_PreviewMouseRightButtonUp"
                                  PreviewMouseLeftButtonUp="ScrollHost_PreviewMouseLeftButtonUp">
                        <Grid x:Name="MediaGrid">
                            <!-- Static frame image for video (first/last frame) - behind video -->
                            <Image x:Name="VideoFrameImage"
                                   Stretch="Uniform"
                                   RenderOptions.BitmapScalingMode="HighQuality"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Visibility="Collapsed"
                                   Opacity="0"
                                   MouseLeftButtonUp="Media_MouseLeftButtonUp"
                                   MouseRightButtonUp="Media_MouseRightButtonUp" />
                            <MediaElement x:Name="VideoElement"
                                          LoadedBehavior="Manual"
                                          UnloadedBehavior="Stop"
                                          Stretch="None"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center"
                                          Visibility="Collapsed"
                                          MouseLeftButtonUp="Media_MouseLeftButtonUp"
                                          MouseRightButtonUp="Media_MouseRightButtonUp"/>
                            <Image x:Name="ImageElement"
                                   Stretch="Uniform"
                                   RenderOptions.BitmapScalingMode="HighQuality"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   MouseLeftButtonUp="Media_MouseLeftButtonUp"
                                   MouseRightButtonUp="Media_MouseRightButtonUp" />
                        </Grid>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- Big start button (first run / no media) -->
            <Button x:Name="BigSelectFolderButton"
                    Style="{StaticResource BigIconButton}"
                    Content="📁"
                    ToolTip="Select folder to start slideshow"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="36"
                    FontWeight="Normal"
                    Click="BigSelectFolderButton_Click" Height="60" Width="60">
                <Button.Effect>
                    <DropShadowEffect BlurRadius="18" ShadowDepth="0" Opacity="0.5"/>
                </Button.Effect>
            </Button>

            <!-- Expanded modern toolbar: centered, auto width, minimal design -->
            <Border x:Name="ToolbarExpandedPanel"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Bottom"
                            Margin="0,0,0,0"
                            CornerRadius="4,4,0,0"
                            Background="#E61C1C1C"
                            BorderThickness="0"
                            Padding="8,6"
                            Opacity="0.98"
                            Panel.ZIndex="100">

                <Border.RenderTransform>
                    <TranslateTransform x:Name="ExpandedTransform" Y="0"/>
                </Border.RenderTransform>
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.3" Color="#000000"/>
                </Border.Effect>
                <Grid>
                    <!-- Single row: all controls centered with vertical separators -->
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                        <!-- Prev / Play / Pause / Next with modern icons -->
                        <Button x:Name="PrevButton"
                                Style="{StaticResource IconButton}"
                                Content="⏮"
                                Click="PrevButton_Click"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="StartButton"
                                Style="{StaticResource IconButton}"
                                Content="⏵"
                                ToolTip="Start slideshow"
                                Click="StartButton_Click"/>

                        <Button x:Name="StopButton"
                                Style="{StaticResource IconButton}"
                                Content="⏸"
                                ToolTip="Pause slideshow"
                                Click="StopButton_Click"
                                Visibility="Collapsed"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="NextButton"
                                Style="{StaticResource IconButton}"
                                Content="⏭"
                                Click="NextButton_Click"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="ReplayButton"
                                Style="{StaticResource IconButton}"
                                Content="⟲"
                                ToolTip="Replay video"
                                Click="ReplayButton_Click"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <ToggleButton x:Name="FitToggle"
                                      Style="{StaticResource PillToggle}"
                                      Content="Fit"
                                      IsChecked="True"
                                      Checked="FitToggle_Checked"
                                      Unchecked="FitToggle_Unchecked"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <TextBlock Text="Zoom"
                                   Margin="8,0,4,0"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontSize="12"/>
                        <TextBlock x:Name="ZoomLabel"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontSize="12"
                                   Margin="0,0,4,0"
                                   MinWidth="40"/>
                        <Button x:Name="ZoomResetButton"
                                Style="{StaticResource IconButton}"
                                Content="100%"
                                Click="ZoomResetButton_Click"
                                FontSize="11"
                                FontFamily="Segoe UI Variable"
                                MinWidth="40"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <ToggleButton x:Name="IncludeVideoToggle"
                                      Style="{StaticResource PillToggle}"
                                      Content="GIF / MP4"
                                      IsChecked="False"
                                      Checked="IncludeVideoToggle_Checked"
                                      Unchecked="IncludeVideoToggle_Unchecked" />

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="MuteButton"
                                Style="{StaticResource IconButton}"
                                Content="🔇"
                                Click="MuteButton_Click"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="FullscreenButton"
                                Style="{StaticResource IconButton}"
                                Content="⛶"
                                Click="FullscreenButton_Click"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="SelectFolderButton"
                                Style="{StaticResource IconButton}"
                                Content="📁"
                                ToolTip="Change folder"
                                Click="SelectFolderButton_Click"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="PlaylistButton"
                                Style="{StaticResource IconButton}"
                                Content="☰"
                                ToolTip="Playlist editor"
                                Click="PlaylistButton_Click"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="SortButton"
                                Style="{StaticResource IconButton}"
                                Content="⇅"
                                ToolTip="Sort options"
                                Click="SortButton_Click">
                            <Button.ContextMenu>
                                <ContextMenu x:Name="SortMenu" Background="{StaticResource SurfaceBrush}">
                                    <MenuItem x:Name="SortNameAZ"
                                              Header="Name (A-Z)"
                                              Tag="NameAZ"
                                              Click="SortMenuItem_Click"/>
                                    <MenuItem x:Name="SortNameZA"
                                              Header="Name (Z-A)"
                                              Tag="NameZA"
                                              Click="SortMenuItem_Click"/>
                                    <MenuItem x:Name="SortDateOldest"
                                              Header="Date (Oldest First)"
                                              Tag="DateOldest"
                                              Click="SortMenuItem_Click"/>
                                    <MenuItem x:Name="SortDateNewest"
                                              Header="Date (Newest First)"
                                              Tag="DateNewest"
                                              Click="SortMenuItem_Click"/>
                                    <MenuItem x:Name="SortRandom"
                                              Header="Random"
                                              Tag="Random"
                                              Click="SortMenuItem_Click"/>
                                </ContextMenu>
                            </Button.ContextMenu>
                        </Button>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <Button x:Name="SettingsButton"
                                Style="{StaticResource IconButton}"
                                Content="⚙"
                                ToolTip="App Settings"
                                Click="SettingsButton_Click"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <TextBlock Text="Delay"
                                   Margin="8,0,4,0"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontSize="12"/>
                        <TextBox x:Name="DelayBox"
                                 Text="2000"
                                 VerticalContentAlignment="Center"
                                 MinWidth="50"
                                 TextAlignment="Right"/>

                        <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                        <!-- Collapse toolbar -->
                        <Button x:Name="ToolbarCollapseButton"
                                Style="{StaticResource IconButton}"
                                Content="▾"
                                ToolTip="Minimize toolbar"
                                Click="ToolbarCollapseButton_Click"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Minimized notch toolbar with minimal design -->
            <Border x:Name="ToolbarNotchPanel"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Bottom"
                    Margin="0,0,0,0"
                    CornerRadius="4,4,0,0"
                    Background="#E61C1C1C"
                    BorderThickness="0"
                    Padding="6,4"
                    Opacity="0"
                    Visibility="Collapsed"
                    Panel.ZIndex="100">
                <Border.RenderTransform>
                    <TranslateTransform x:Name="NotchTransform" Y="0"/>
                </Border.RenderTransform>
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.3" Color="#000000"/>
                </Border.Effect>
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Margin="0">
                    <Button x:Name="NotchPrevButton"
                            Style="{StaticResource IconButton}"
                            Content="⏮"
                            Click="NotchPrevButton_Click"/>

                    <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                    <Button x:Name="NotchPlayPauseButton"
                            Style="{StaticResource IconButton}"
                            Content="⏵"
                            Click="NotchPlayPauseButton_Click"/>

                    <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                    <Button x:Name="NotchNextButton"
                            Style="{StaticResource IconButton}"
                            Content="⏭"
                            Click="NotchNextButton_Click"/>

                    <Rectangle Width="1" Height="20" Fill="{StaticResource SubtleBorderBrush}" Margin="0" VerticalAlignment="Center" Opacity="0.3"/>

                    <Button x:Name="ToolbarExpandButton"
                            Style="{StaticResource IconButton}"
                            Content="▴"
                            ToolTip="Expand toolbar"
                            Click="ToolbarExpandButton_Click"/>
                </StackPanel>
            </Border>

            <Border x:Name="StatusBar"
                    VerticalAlignment="Bottom"
                    HorizontalAlignment="Left"
                    Margin="16,0,0,24"
                    Padding="8,6"
                    Background="Transparent"
                    BorderThickness="0">
                <TextBlock x:Name="StatusText"
                           FontSize="11"
                           Foreground="{StaticResource TextMutedBrush}"
                           Text=""
                           TextTrimming="CharacterEllipsis"
                           TextWrapping="NoWrap"/>
            </Border>

            <TextBlock x:Name="TitleCountText"
                       VerticalAlignment="Bottom"
                       HorizontalAlignment="Right"
                       Margin="0,0,16,24"
                       FontSize="12"
                       Foreground="{StaticResource TextMutedBrush}"/>

            <!-- Very bottom thin progress bar (video) -->
            <ProgressBar x:Name="VideoProgressBar"
                         Height="4"
                         Minimum="0"
                         Maximum="100"
                         Width="200"
                         VerticalAlignment="Bottom"
                         Visibility="Collapsed"
                         MouseDown="VideoProgressBar_MouseDown"
                         MouseMove="VideoProgressBar_MouseMove"
                         MouseLeave="VideoProgressBar_MouseLeave"
                         Panel.ZIndex="110"/>
            
            <!-- Loading overlay -->
            <Border x:Name="LoadingOverlay"
                    Background="#80000000"
                    Opacity="0"
                    Visibility="Collapsed"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Stretch"
                    Panel.ZIndex="200"
                    IsHitTestVisible="False">
                <Grid>
                    <StackPanel HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Orientation="Vertical">
                        <ProgressBar IsIndeterminate="True"
                                     Width="100"
                                     Height="4"
                                     Margin="0,0,0,12"
                                     Foreground="{StaticResource AccentBrush}"/>
                        <TextBlock Text="Loading..."
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   FontSize="14"
                                   HorizontalAlignment="Center"
                                   Opacity="0.9"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
        <TextBlock x:Name="HoverTimeText"
                   Margin="8,0,0,0"
                   VerticalAlignment="Center"
                   Foreground="#AAAAAA"
                   FontSize="10"
                   Visibility="Collapsed"/>
    </Grid>
</Window>
